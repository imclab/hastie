#!/usr/bin/env ruby
# -*- mode: ruby -*-

# require 'rubygems'
# puts Gem.loaded_specs["jekyll"].bindir

require 'hastie/report_generator'
require 'hastie/report_generator'

module Hastie
  module Executable
    HELP = <<-HELP
Usage: hastie [ command ] <command-options>

Hastie Commands:
  version - Print version number and exit
  help    - Print this help and exit
  start   - Create new report directory framework with given name
  watch   - Monitor current directory for changes,
             updating local copy of report
  publish - Send report to server. Update published reports

Hastie start options:
  Use 'hastie start -h' for more information on start options

Hastie publish options:
  Use 'hastie publish -h' for more information on publish options

    HELP


    def self.execute(command, args)
      case command
      when "version"
        require 'hastie/version'
        puts Hastie::VERSION
      when "start","create"
        Hastie::ReportGenerator.start ARGV
      when "watch", "monitor"
        puts "Starting Jekyll..."
        exec("jekyll --auto --server #{ARGV}")
      when "publish"
        Hastie::ReportPublisher.start ARGV
      else
        puts Hastie::Executable::HELP
      end
    end
  end
end

command = ARGV.shift
Hastie::Executable.execute command, ARGV
